<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="report_payment_receipt_document_inherit" inherit_id="account.report_payment_receipt_document">
  <xpath expr="//div[@class='page']" position="replace">
    <div class="page">
      <!-- Title + Number -->
      <t t-set="layout_document_title">
                    <t t-if="o.payment_type == 'inbound'">Receipt Voucher</t>
                    <t t-else="True">Payment Voucher</t>
                <!-- <div><span t-field="o.name"> -->
                    <!-- Modify the document number based on the payment type -->
                    <!-- <t t-if="o.payment_type == 'inbound'">Receipt No.:</t> -->
                    <!-- <t t-else="True">Voucher No.:</t> -->
               <!-- </span></div>
      </t>
      <div class="mb-4" style="margin-bottom:14px;">
        <span t-if="o.payment_type == 'inbound'">Receipt No.:</span>
        <span t-else="">Voucher No.:</span>
        <span class="ms-1" t-esc="o.name"/>
      </div>

      <!-- Top info as a borderless table -->
      <table class="table table-borderless table-sm mb-4" style="margin-bottom:14px;">
        <tbody>
          <tr t-if="o.date or o.x_instrument_date">
            <td class="w-50" t-if="o.date">
              Payment Date: <span t-field="o.date"/>
            </td>
            <td class="w-50" t-if="o.x_instrument_date">
              Instrument Date: <span t-field="o.x_instrument_date"/>
            </td>
          </tr>
          <tr>
            <td>
              <t t-if="o.partner_type == 'customer'">Customer:</t>
              <t t-elif="o.partner_type == 'supplier'">Vendor:</t>
              <t t-else="">Partner:</t>
              <span class="ms-1" t-field="o.partner_id"/>
            </td>
            <td t-if="o.x_instrument_number">
              Instrument Number: <span t-field="o.x_instrument_number"/>
            </td>
          </tr>
          <tr>
            <td t-if="o.amount">
              Payment Amount:
              <span class="ms-1" t-field="o.amount"
                    t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
            </td>
            <td t-if="values.get('display_payment_method') and o.payment_method_line_id">
              Payment Method: <span class="ms-1" t-field="o.payment_method_line_id.name"/>
            </td>
          </tr>
          <!-- Cheque details (conditional) -->
          <tr t-if="o.x_cheque_no or o.x_cheque_date">
            <td t-if="o.x_cheque_no">
              Cheque No.: <span class="ms-1" t-esc="o.x_cheque_no"/>
            </td>
            <td t-if="o.x_cheque_date">
              Cheque Date: <span class="ms-1" t-field="o.x_cheque_date"/>
            </td>
          </tr>
          <!-- Memo (single location only) -->
          <tr t-if="o.memo">
            <td colspan="2">
              <strong>Memo:</strong><span class="ms-1" t-field="o.memo"/>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Your invoices table (unchanged logic) -->
      <t t-set="invoices" t-value="o.reconciled_invoice_ids or o.reconciled_bill_ids"/>
      <t t-foreach="invoices" t-as="inv">
        <t t-if="any(inv.currency_id != par[2].currency_id for par in inv._get_reconciled_invoices_partials()[0])"
           t-set="otherCurrency" t-value="True"/>
      </t>
      <table name="invoices" t-if="values['display_invoices']" class="table table-borderless">
        <thead>
          <tr>
            <th><span>Invoice Date</span></th>
            <th><span>Invoice Number</span></th>
            <th><span>Reference</span></th>
            <th t-if="otherCurrency" class="text-end"><span>Amount In Currency</span></th>
            <th class="text-end"><span>Amount</span></th>
          </tr>
        </thead>
        <tbody>
          <t t-foreach="invoices" t-as="inv">
            <t t-if="inv.move_type != 'entry'">
              <tr>
                <td><span t-field="inv.invoice_date"/></td>
                <td><span t-field="inv.name"/></td>
                <td><span t-field="inv.ref"/></td>
                <td t-if="otherCurrency"/>
                <td class="text-end">
                  <span t-field="inv.amount_total"
                        t-options="{'widget': 'monetary', 'display_currency': inv.currency_id}"/>
                </td>
              </tr>
              <tr t-foreach="inv._get_reconciled_invoices_partials()[0]" t-as="par">
                <t t-set="payment" t-value="par[2]"/>
                <td><span t-field="payment.move_id.date"/></td>
                <td><span t-field="payment.move_id.name"/></td>
                <td><span t-field="payment.payment_id.memo"/></td>
                <t t-set="amountPayment" t-value="-par[0].amount"/>
                <t t-set="amountInvoice" t-value="-par[1]"/>
                <t t-set="currencyPayment" t-value="payment.currency_id"/>
                <t t-set="currencyInvoice" t-value="inv.currency_id"/>
                <td t-if="otherCurrency" class="text-end">
                  <span t-if="currencyPayment != currencyInvoice"
                        t-out="amountPayment"
                        t-options="{'widget': 'monetary', 'display_currency': currencyPayment}"/>
                </td>
                <td class="text-end">
                  <span t-out="amountInvoice"
                        t-options="{'widget': 'monetary', 'display_currency': currencyInvoice}"/>
                </td>
              </tr>
              <tr>
                <td/>
                <td><strong>Due Amount for <span t-field="inv.name"/></strong></td>
                <td/>
                <td t-if="otherCurrency"/>
                <td class="text-end"><strong><span t-field="inv.amount_residual"/></strong></td>
              </tr>
            </t>
          </t>
        </tbody>
      </table>

      <!-- Bank account line -->
      <div class="mt-2" t-if="o.partner_bank_id">
        <t t-if="o.payment_type == 'outbound'">Transferred to</t>
        <t t-else="">Receive at</t>
        <t t-esc="': '"/>
        <span t-esc="o.partner_bank_id.acc_number or o.partner_bank_id.name"/>
      </div>

      <!-- Footer with extra spacing -->
      <div class="row mt-5" style="margin-top:32px;">
        <div class="col-6">
          Created by: <span class="ms-1" t-field="o.create_uid"/>
        </div>
        <div class="col-6 text-end">
          Signature: ____________________
        </div>
      </div>
    </div>
  </xpath>
</template>
</odoo>